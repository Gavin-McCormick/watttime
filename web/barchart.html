<!DOCTYPE html>
<html>
  <head>
    <title>bar charts</title>
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js?1.29.1"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>
<style type="text/css">
 
svg {
  width: 300px;
  height: 300px;
  border: solid 1px #ccc;
  font: 10px sans-serif;
  shape-rendering: crispEdges;
}

.bar.green {
  fill: green;
}

.bar.fossil {
  fill: black;
}

.axis text {
  font: 10px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}
 
    </style>
  </head>
  <body>
<div id='kw-chart-weekdays'></div>
<div id='kw-chart-weekdays'></div>
    <script type="text/javascript">

url = 'localhost:8080'
$.getJSON(url + '/average/1?start=201201010000&grouping=weekdays',
function(data) {

// get data to plot from json
var weekdays_kw = [];
var weekends_kw = [];

var n_hours = data.buckets.weekends.length;

for (var i=0; i < n_hours; i++) {

weekends_kw.push({
'hour': i,
'val': data.buckets.weekends[i].total_green_kwh
});
weekends_kw.push({
'hour': i,
'val': -(data.buckets.weekends[i].total_kwhs - data.buckets.weekends[i].total_green_kwh)
});

weekdays_kw.push({
'hour': i,
'val': data.buckets.weekdays[i].total_green_kwh
});
weekdays_kw.push({
'hour': i,
'val': -(data.buckets.weekdays[i].total_kwhs - data.buckets.weekends[i].total_green_kwh)
});


}

draw_bar_chart(weekdays_kw, 'kw-chart-weekdays');
draw_bar_chart(weekends_kw, 'kw-chart-weekends');
});


// set up chart variables
var margin = {top: 10, right: 10, bottom: 10, left: 40},
    width = 300 - margin.left - margin.right,
    height = 300 - margin.top - margin.bottom;


// define chart drawing function
var draw_bar_chart = function(data, div_id) {
var x = d3.scale.ordinal()
.domain([0,24])
.rangeRoundBands([0, width], 0.2);

var y = d3.scale.linear()
.domain(d3.extent(data, function(d) {return d.val ;})).nice()
.rangeRound([height,0]).nice();

// add the canvas to the DOM
var chart = d3.select(div_id).append("svg:svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height/2.0 + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

chart.selectAll("rect").
  data(data).
  enter().
  append("svg:rect").
attr("class", function(d) { return d.kw < 0 ? "bar fossil" : "bar green"; }).
  attr("x", function(d, i) { return x(d.hour); }).
  attr("y", function(d) { return y_kw(Math.max(0,d.val)); }).
  attr("height", function(d) { return Math.abs(y(d.val)-y(0)); }).
  attr("width", width/25.0).
  attr("fill", d3.rgb("rgb(7,153,72)"));

  chart.append("g")
      .attr("class", "x axis")
    .append("line")
      .attr("y1", y(0))
      .attr("y2", y(0))
      .attr("x1", width);

var yAxis = d3.svg.axis()
    .scale(y)
.tickFormat(d3.format(".2f"))
    .orient("left");
kw_chart.append("g")
.attr("class", "y axis")
.call(yAxis);

var xAxis = d3.svg.axis()
    .scale(x)
.tickFormat(d3.time.format("%H"))
    .orient("bottom");
chart.append("g")
.attr("class", "x axis")
.call(xAxis);

}


   </script>
  </body>
</html>